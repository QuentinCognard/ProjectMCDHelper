{% extends "base_excerciseur.html" %}
{% block styles %}
{{ super() }}
  <link rel="stylesheet" href= "{{url_for('static',filename='new_relation.css') }}"/>
{% endblock %}
{% block contain %}
<form method='post' class="bd-example" action="">
  <fieldset class="fieldset">
    <legend>Nouvelle relation</legend>
    <p>
      <label for="input">Nom relation :</label>
      <input type="text" name="nomR" placeholder="Nom de la relation" required />
    </p>
    <input id="hidden" type='hidden' name='nbAtt' value='0'>

    <button type="button" class="ajouteAttribut" onClick="ajouteElement()">Ajouter attribut</button>



    <section>
      <input id="hidden" type='hidden' name='nbEnt' value='0'>
      <div class="entite" id="ent1">
        <label>Entite1: </label>
        <select >
        {% for elem in entites %}
            <option value="{{elem.nomEntite}}">{{elem.nomEntite}}</option>
        {% endfor %}
        </select>
      </div>
      <div class="entite" id="ent2">
            <label>Entite2: </label>
        <select >
        {% for elem in entites %}
            <option value="{{elem.nomEntite}}">{{elem.nomEntite}}</option>
        {% endfor %}
        </select>
      </div>
      <button type="button" class="ajouteAttribut" onClick="ajouteEntite()">Ajouter entite</button>
    </section>

    <p>
      <a href="{{url_for('page_ajouter_relation',username=username,idProj=idProj)}}"><button class="btn btn-warning" role="button">Annuler</button></a>
      <button class="btn btn-success" type="submit">Valider</button>

    </p>
  </fieldset>
</form>

<script>
  var nbAtt = 0;
  var listAtt = [];
  // supprime un attribut
  function removeAttribut(id){
    var parent = document.querySelector(".fieldset");
    var child = document.getElementById("att"+id);
    parent.removeChild(child);
    var start=parseInt(id)+1;
    var end=parseInt(nbAtt)+1;
    for (var i = start; i < end; i++){
      var attribut = document.getElementById("att"+i);
      attribut.id = "att"+(i-1);
      var bouton = document.getElementById(""+i);
      bouton.id = ""+(i-1);
    }
    nbAtt -= 1;
    var hidden = document.getElementById("hidden");
    hidden.value=nbAtt;
  }

  // ajoute un attribut
  function ajouteElement(){
      nbAtt += 1;
      var hidden = document.getElementById("hidden");
      hidden.value=nbAtt;
      var divAttribut = document.createElement("div");
      divAttribut.className="attribut";
      divAttribut.id = "att"+nbAtt;

      ajouteSuppButton(divAttribut);
      ajouteNom(divAttribut);

      var divActuel = document.querySelector(".ajouteAttribut");
      document.querySelector(".fieldset").insertBefore(divAttribut, divActuel);
  }

  // ajoute le bouton de supression de l'attribut
  function ajouteSuppButton(divAttribut){
    var bouton = document.createElement("button");
    divAttribut.appendChild(bouton);
    var textBouton = document.createTextNode("X");
    bouton.appendChild(textBouton);
    bouton.className = "suppBout btn btn-danger";
    bouton.type = "button";
    bouton.id = nbAtt;
    bouton.onclick = function(){removeAttribut(bouton.id)};
  }

  // ajoute le champde saisie du nom
  function ajouteNom(divAttribut){
      var p1 = document.createElement("p");
      divAttribut.appendChild(p1)
      var labNomAtt = document.createElement("label");
      labNomAtt.for="input";
      var textNom = document.createTextNode("Attribut :");
      labNomAtt.appendChild(textNom);
      p1.appendChild(labNomAtt);

      //Create array of options to be added

      //Create and append select list
      var selectList = document.createElement("select");
      selectList.id = "mySelect";
      p1.appendChild(selectList);
      //Create and append the options
      {% for elem in attributs %}
          var option = document.createElement("option");
          option.value = "{{elem.nomAttribut}}";
          option.text = "{{elem.nomAttribut}}";
          selectList.appendChild(option);
      {% endfor %}
      }



</script>
{% endblock %}
