{% extends "base_excerciseur.html" %}
{% block styles %}
{{ super() }}
<link rel="stylesheet" href= "{{url_for('static',filename='create_mcd.css') }}"/>
{% endblock %}

{% block contain %}
<form role="form" method="POST">
  <fieldset class="lesentites">


<!-- Cette div devra se répéter autant de fois qu'il y a d'entité -->

    <div class="bordmcd">
      <legend>Nouveau MCD</legend>
      <p>
        <label for="input">Nom Entité :</label>
        <input type="text" id="nameent" placeholder="Nom de l'entité" />
      </p>

      <input id="hiddenEnt" type="hidden" name="nbEnt" value="0">


    <div class="lesattributs">
    <div class="attEntite">
      <input id="hiddenAtt" type="hidden" name="nbAtt" value="0">
      <p>
        <label for="select">Nom attribut :</label>
        <select id="typeatt">
          <option value="">Choisir...</option>
            <option value="">Integer</option>
            <option value="">Float</option>
            <option value="">String</option>
            <option value="">Char</option>
            <option value="">Date</option>
        </select>
      </p>

      <p>
        <label for="input"> Clé primaire </label>
          <input id="checkprimary" type="checkbox">
      </p>
    </div>
  </div>

    <p>
      <button class ="btn btn-info" type="button" onClick="ajouteAttribut('0')">Ajouter Attribut</button>
    </p>

    </div>

    <div>
      <p>
        <button class ="btn btn-primary" type="button" onClick="ajouteEntite()">Ajouter Entité</button>
      </p>
      <a href="/projets" class="btn btn-danger" role="button">Annuler</a>


      <a href="/projets/0/relation_resume" class="btn btn-success" role="button">Ajouter les entités</a>
    </div>

  </fieldset>
</form>

<script>

  var nbAtt = 0;
  var nbEnt = 0;

  firstdiv = document.querySelector(".bordmcd");
  firstdiv.id="ent"+nbEnt;

  // supprime une entite
  function removeEntite(id){
    var parent = document.querySelector(".lesentites");
    var child = document.getElementById(id);
    // document.write(parent.id);
    // document.write(child.id);
    parent.removeChild(child);
    nbEnt --;
  }

  // supprime un attribut d'une entite
  function removeAttribut(attid,entid){
    var child = document.getElementById(attid);
    var parent = document.getElementById(entid);
    var divattParent = parent.querySelector(".lesattributs");
    // document.write(parent);
    divattParent.removeChild(child);
    nbAtt --;
  }

  // ajoute une entite
  function ajouteEntite(){
      nbEnt += 1;
      var divEntite = document.createElement("div");
      divEntite.className="bordmcd";
      divEntite.id = "ent"+nbEnt;

      var hidEnt=document.getElementById("hiddenEnt");
      hidEnt.value=nbEnt;

      var divActuel = document.querySelector(".bordmcd");
      document.querySelector(".lesentites").insertBefore(divEntite,divActuel.nextSibling);

      ajouteSuppButtonEnt(divEntite);
      ajouteNom(divEntite);
      ajouteHidden(divEntite);
      ajouteDivAtt(divEntite);
      ajouteAttribut(nbEnt);
      ajouteAttributBouton(divEntite);
      // ajouteValeur(divAttribut);
      // ajouteQuantite(divAttribut);
      // ajouteGenre(divAttribut);
      // document.write(divEntite.querySelector(".lesattributs"));


  }

  // ajoute le bouton de supression d'une entité
  function ajouteSuppButtonEnt(divEntite){
    var bouton = document.createElement("button");
    divEntite.appendChild(bouton);
    var textBouton = document.createTextNode("-");
    bouton.appendChild(textBouton);
    bouton.className = "btn btn-danger";
    bouton.type = "button";
    bouton.id = divEntite.id;
    bouton.onclick = function(){removeEntite(divEntite.id)};
  }

  // ajoute le champde saisie du nom d'une entite
  function ajouteNom(divEntite){
      var p1 = document.createElement("p");
      divEntite.appendChild(p1)
      var labNomEnt = document.createElement("label");
      labNomEnt.for="input";
      var textNom = document.createTextNode("Nom Entité :");
      labNomEnt.appendChild(textNom);
      var inputNomEnt = document.createElement("input");
      inputNomEnt.type="text";
      inputNomEnt.placeholder="Nom de l'entité";
      inputNomEnt.required="required";
      p1.appendChild(labNomEnt);
      p1.appendChild(inputNomEnt);
  }

  //ajoute le champ invisible contenant l'id d'Entite

  function ajouteAttributBouton(divEntite){
    var p2 = document.createElement("p");
    divEntite.appendChild(p2);
    var bouton = document.createElement("button");
    var textBouton = document.createTextNode("Ajouter Attribut");
    bouton.appendChild(textBouton);
    bouton.className = "btn btn-info";
    bouton.type = "button";
    var nbEntStati = nbEnt;
    bouton.id = nbEnt;
    bouton.onclick = function(){ajouteAttribut(nbEntStati)};
    p2.appendChild(bouton);
  }

  // ajoute la division des attributs
  function ajouteDivAtt(divEntite){
    var divatt=document.createElement("div");
    divatt.className="lesattributs";
    divEntite.appendChild(divatt);
  }

  // ajoute un attribut
  function ajouteAttribut(nbEntS){
      nbAtt += 1;
      var parent = document.getElementById("ent"+nbEntS);

      var divAttribut = document.createElement("div");
      divAttribut.className="attEntite";
      divAttribut.id = "att"+nbAtt;

      var hidAtt=document.getElementById("hiddenAtt");
      hidAtt.value=nbAtt;

      ajouteSuppButtonAtt(divAttribut,parent);
      ajouteNomAtt(divAttribut);
      ajouteCle(divAttribut);
      // ajouteValeur(divAttribut);
      // ajouteQuantite(divAttribut);
      // ajouteGenre(divAttribut);
      // var divActuel = document.querySelector(".attEntite");
      // divEntite.querySelector(".lesattributs").insertBefore(divAttribut, divActuel.nextSibling);
      var lesatt=parent.querySelector(".lesattributs");
      lesatt.appendChild(divAttribut);

      // document.write(divEntiteCourante.id);
      // document.write(divEntiteCourante.id);
      // document.write(divAttribut.id);
      // document.write(divActuel.id);

      // divEntite.appendChild(divAttribut);
  }

  // ajoute le bouton de supression d'une entité
  function ajouteSuppButtonAtt(divAttribut,parent){
    var bouton = document.createElement("button");
    divAttribut.appendChild(bouton);
    var textBouton = document.createTextNode("-");
    bouton.appendChild(textBouton);
    bouton.className = "btn btn-danger";
    bouton.type = "button";
    bouton.id = divAttribut.id;
    bouton.onclick = function(){removeAttribut(divAttribut.id,parent.id)};
  }

  // ajoute le champde saisie du nom de
  function ajouteNomAtt(divAttribut){
    var p2 = document.createElement("p");
    divAttribut.appendChild(p2);
    var labTypeAtt = document.createElement("label");
    labTypeAtt.for = "select";
    var textType = document.createTextNode("Nom attribut :");
    labTypeAtt.appendChild(textType);
    var selTypeAtt = document.createElement("select");
    p2.appendChild(labTypeAtt);
    p2.appendChild(selTypeAtt);
    var opt1 = document.createElement("option");
    var opt2 = document.createElement("option");
    var opt3 = document.createElement("option");
    var opt4 = document.createElement("option");
    var opt5 = document.createElement("option");
    opt1.value = "integer";
    opt2.value = "float";
    opt3.value = "string";
    opt4.value = "char";
    opt5.value = "date";
    var textOpt1 = document.createTextNode("Integer");
    var textOpt2 = document.createTextNode("Float");
    var textOpt3 = document.createTextNode("String");
    var textOpt4 = document.createTextNode("Char");
    var textOpt5 = document.createTextNode("Date");
    opt1.appendChild(textOpt1);
    opt2.appendChild(textOpt2);
    opt3.appendChild(textOpt3);
    opt4.appendChild(textOpt4);
    opt5.appendChild(textOpt5);
    selTypeAtt.appendChild(opt1);
    selTypeAtt.appendChild(opt2);
    selTypeAtt.appendChild(opt3);
    selTypeAtt.appendChild(opt4);
    selTypeAtt.appendChild(opt5);
  }

  function ajouteCle(divAttribut){
    var p1 = document.createElement("p");
    divAttribut.appendChild(p1)
    var labCle = document.createElement("label");
    labCle.for="input";
    var textCle = document.createTextNode(" Clé primaire ");
    labCle.appendChild(textCle);
    var inputCle = document.createElement("input");
    inputCle.id="checkprimary";
    inputCle.type="checkbox";
    p1.appendChild(labCle);
    p1.appendChild(inputCle);
  }



</script>
{% endblock %}
